/*xuexb_blog - v0.0.1 - 2015-05-31  21:05:23*/
"use strict";var App={};App.allAction=function(){return App.indexAction.call(this)},App.indexAction=function(){var a=this;return a.display(VIEW_PATH+"/Touch/index_index.html")},App.tag_listAction=function(){return App.indexAction.call(this)},App.tagsAction=function(){return App.indexAction.call(this)},App.searchAction=function(){var a=this,b=a.get("key").trim();return a.assign("key",b),App.indexAction.call(this)},App.listAction=function(){var a=this,b=a.get("url");return D("List").get({one:1,where:{url:b},field:"id, name, url"}).then(function(b){return isEmpty(b)?a.__404Action():(a.assign("nav_list_id",b.id),a.assign("nav_list_name",b.name),App.indexAction.call(a))})},App.viewAction=function(){var a=this,b={},c=a.get("url");return c?(parseInt(c,10)?b.id=parseInt(c,10):b.url=c,b.id||b.url?D("Article").get({one:1,field:"id, markdown_content, hit, update_date, list_id, title, url, catalog",where:b}).then(function(b){var c;return isEmpty(b)?a.__404Action():(c=[D("List").get({one:1,field:"url, name, id",where:{id:b.list_id}})],c.push(D("Article").where({id:b.id}).updateInc("hit")),Promise.all(c).then(function(c){var d;return isEmpty(c)||isEmpty(c[0])?a.__404Action():(d=c[0],a.assign("list_name",d.name),a.assign("list_url",d.url),a.assign("list_uri",Url.article.list(d.id,d.url)),b.update_date=Date.elapsedDate(b.update_date,"yyyy-M-d h:m"),a.assign("data",b),a.assign("title",b.title),a.display())}))}):a.__404Action()):a.__404Action()},module.exports=Controller("Touch/BaseController",function(){return App});